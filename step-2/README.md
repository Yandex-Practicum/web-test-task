### Чек-лист для проверки

---

Важно: вам не нужно покрывать тестами весь список. Всё зависит от вас. Но помните, что р*а*боты могут быть с очень разной реализацией.

- **step-2**
    - При сборке или запуске проекта возникают ошибки.
    - Часть функциональности не реализована: например, невозможно создать пользователя или отсутствует мидлвэр для авторизации.
    - Работа содержит вопросы или просьбы о помощи к ревьюеру.
    - На повторных итерациях не исправлены критические замечания.
    
    *Общее*
    
    - Если в любом из запросов что-то идёт не так, сервер возвращает ответ с ошибкой и соответствующим ей статусом:
        - **400** — переданы некорректные данные в метод создания карточки, пользователя, обновления аватара пользователя и профиля;
        - **401** — передан неверный логин или пароль;
        - **401** — эту ошибку возвращает авторизационный мидлвэр, если передан не верный JWT;
        - **403** — попытка удалить чужую карточку;
        - **404** — карточка или пользователь не найден, или был запрошен несуществующий роут;
        - **409** — при регистрации указан email, который уже существует на сервере;
        - **500** — ошибка по-умолчанию. Сопровождается сообщением "На сервере произошла ошибка";
        
        Перед отправкой ошибки не забудьте проверить ее, например так:
        
        ```
        const ERROR_CODE = 400;
        
        if(err.name === 'SomeErrorName') return res.status(ERROR_CODE).send(...)
        
        ```
        
    - В контроллерах предусмотрена гарантированная отправка сообщения об ошибке.
    - Ответ с ошибкой содержит только поле `message`. Сообщение об ошибке соответсвует ее типу.
    
    **Авторизация и регистрация пользователя**
    
    - при разных запросах сервер не падает;
    - нет ошибок линтинга;
    - в схеме пользователя есть обязательные `email` и `password`;
    - поле `email` уникально (есть опция unique: true);
    - поле `email` валидируется на предмет того, что соответствует паттерну почты (можно использовать validator);
    - поле `password` не имеет ограничения на длину, т.к. пароль хранится в виде хэша
    - в контроллере `createUser` почта и хеш пароля записываются в базу;
    - есть контроллер `login`, он проверяет, полученные в теле запроса почту и пароль;
    - если почта и пароль верные, контроллер `login` создаёт JWT, в пейлоуд которого записано свойство `_id` с идентификатором пользователя;
    - jwt токен выпускается на определённый срок (например, 7 дней), а не даётся бессрочно;
    - если почта и пароль верные, контроллер `login` возвращает созданный токен в ответе (это может быть тело ответа или заголовок Set-Cookie);
    - в `app.js` есть обработчики POST-запросов на роуты `/signin` и `/signup`;
    - есть файл `middlewares/auth.js`, в нём мидлвэр для проверки JWT;
    - при правильном JWT авторизационный мидлвэр добавляет в объект запроса пейлоуд токена и пропускает запрос дальше;
    - все роуты, кроме `/signin` и `/signup`, защищены авторизацией;
    - удалён хардкод `req.user` из самостоятельного проекта предыдущих спринтов;
    - пользователь не может удалить карточку, которую он не создавал;
    - API не возвращает хеш пароля;
    - Пользователь не может редактировать чужой профиль и не может менять чужой аватар.
    
    **Обработка ошибок и валидация**
    
    - студент не реализовал централизованную обработку ошибок в единой middleware;
    - тела запросов и, где необходимо, параметры запроса должны валидироваться по определённым схемам. Если запрос не соответствует схеме, обработка не передаётся контроллеру и клиент получает ошибку валидации;
    - Поля avatar и link проверяются регулярным выражением. Шаблон находит URL таких форматов:
    
    ```
    <http://ya.ru>
    <https://www.ya.ru>
    <http://2-domains.ru>
    <http://ya.ru/path/to/deep/>
    <http://ya-ya-ya.ru>
    
    ```
